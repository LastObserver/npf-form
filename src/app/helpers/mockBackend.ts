import { Injectable } from '@angular/core';
import { HttpRequest, HttpResponse, HttpHandler, HttpEvent, HttpInterceptor, HTTP_INTERCEPTORS } from '@angular/common/http';
import { Observable } from 'rxjs/Observable';
import 'rxjs/add/observable/of';
import 'rxjs/add/observable/throw';
import 'rxjs/add/operator/delay';
import 'rxjs/add/operator/mergeMap';
import 'rxjs/add/operator/materialize';
import 'rxjs/add/operator/dematerialize';

@Injectable()
export class mockBackend implements HttpInterceptor {

  constructor() { }

  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {

    return Observable.of(null).mergeMap(() => {

      if (request.url.endsWith('/') && request.method === 'POST') {
        let body = { "status": "form", "form": { "personal": { "type": "form", "attributes": [], "name": "personal", "fullName": ["personal"], "errors": [], "value": { "last_name": "Клиент", "name": "Клиент", "no_second_name": "", "second_name": "Клиент", "gender": "M", "tel": "71241241241", "tel_stat": "", "email": "test@test.test", "personal_data": "1", "captcha": { "sid": "0d4bbea31f48f5ab992b3daa134233fb", "word": "75256" } }, "label": "", "elements": { "last_name": { "type": "input", "attributes": [], "name": "last_name", "fullName": ["personal", "last_name"], "errors": [], "value": "Клиент", "label": "Фамилия" }, "name": { "type": "input", "attributes": [], "name": "name", "fullName": ["personal", "name"], "errors": [], "value": "Клиент", "label": "Имя" }, "no_second_name": { "type": "checkbox", "attributes": [], "name": "no_second_name", "fullName": ["personal", "no_second_name"], "errors": [], "value": "", "label": "Нет отчества" }, "second_name": { "type": "input", "attributes": [], "name": "second_name", "fullName": ["personal", "second_name"], "errors": [], "value": "Клиент", "label": "Отчество" }, "gender": { "type": "radiolist", "attributes": [], "name": "gender", "fullName": ["personal", "gender"], "errors": [], "value": "M", "label": "Пол", "list": { "M": "Мужской", "F": "Женский" }, "listItemsOptions": [], "multiple": false }, "tel": { "type": "input", "attributes": [], "name": "tel", "fullName": ["personal", "tel"], "errors": [], "value": "71241241241", "label": "Номер мобильного телефона" }, "tel_stat": { "type": "input", "attributes": [], "name": "tel_stat", "fullName": ["personal", "tel_stat"], "errors": [], "value": "", "label": "Номер домашнего телефона" }, "email": { "type": "input", "attributes": [], "name": "email", "fullName": ["personal", "email"], "errors": [], "value": "test@test.test", "label": "E-mail" }, "personal_data": { "type": "checkbox", "attributes": [], "name": "personal_data", "fullName": ["personal", "personal_data"], "errors": [], "value": "1", "label": "Я даю Согласие на обработку персональных данных" }, "captcha": { "type": "captcha", "attributes": [], "name": "captcha", "fullName": ["personal", "captcha"], "errors": [], "value": { "sid": "0d4bbea31f48f5ab992b3daa134233fb", "word": "75256" }, "label": "", "captcha": { "sid": "0d4bbea31f48f5ab992b3daa134233fb", "src": "/bitrix/tools/captcha.php?captcha_sid=0d4bbea31f48f5ab992b3daa134233fb" } } } }, "passport": { "type": "form", "attributes": [], "name": "passport", "fullName": ["passport"], "errors": { "birthdate": ["Поле обязательно для заполнения"], "passportseries": ["Поле обязательно для заполнения"], "passportnumber": ["Поле обязательно для заполнения"], "birth_place": ["Поле обязательно для заполнения"], "issue_date": ["Поле обязательно для заполнения"], "issue_org_code": ["Поле обязательно для заполнения"], "issue_org": ["Поле обязательно для заполнения"], "reg_index": ["Поле обязательно для заполнения"], "reg_federal": ["Поле обязательно для заполнения"], "reg_region": ["Поле обязательно для заполнения"], "reg_ctype": ["Поле обязательно для заполнения"], "reg_cname": ["Поле обязательно для заполнения"], "reg_street": ["Поле обязательно для заполнения"], "reg_house": ["Поле обязательно для заполнения"], "reg_apt": ["Поле обязательно для заполнения"], "fact_index": ["Поле обязательно для заполнения"], "fact_federal": ["Поле обязательно для заполнения"], "fact_region": ["Поле обязательно для заполнения"], "fact_ctype": ["Поле обязательно для заполнения"], "fact_cname": ["Поле обязательно для заполнения"], "fact_street": ["Поле обязательно для заполнения"], "fact_house": ["Поле обязательно для заполнения"], "fact_apt": ["Поле обязательно для заполнения"], "inn": ["Недостаточно данных для проверки"], "confirm_my_data": ["Поле обязательно для заполнения"], "sms_code": ["Поле обязательно для заполнения"] }, "value": { "birthdate": null, "passportseries": null, "passportnumber": null, "birth_place": null, "issue_date": null, "issue_org_code": null, "issue_org": null, "reg_index": null, "reg_federal": null, "reg_region": null, "reg_ctype": null, "reg_cname": null, "reg_street": null, "reg_no_street": null, "reg_house": null, "reg_build": null, "reg_apt": null, "reg_no_apt": null, "fact_reg": null, "fact_index": null, "fact_federal": null, "fact_region": null, "fact_ctype": null, "fact_cname": null, "fact_street": null, "fact_no_street": null, "fact_house": null, "fact_build": null, "fact_apt": null, "fact_no_apt": null, "inn": null, "snils": null, "confirm_my_data": null, "sms_code": null }, "label": "", "elements": { "birthdate": { "type": "input", "attributes": [], "name": "birthdate", "fullName": ["passport", "birthdate"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Дата рождения" }, "passportseries": { "type": "input", "attributes": [], "name": "passportseries", "fullName": ["passport", "passportseries"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Серия/номер паспорта гражданина РФ" }, "passportnumber": { "type": "input", "attributes": [], "name": "passportnumber", "fullName": ["passport", "passportnumber"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Номер паспорта гражданина РФ" }, "birth_place": { "type": "input", "attributes": [], "name": "birth_place", "fullName": ["passport", "birth_place"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Место рождения" }, "issue_date": { "type": "input", "attributes": [], "name": "issue_date", "fullName": ["passport", "issue_date"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Дата выдачи паспорта" }, "issue_org_code": { "type": "input", "attributes": [], "name": "issue_org_code", "fullName": ["passport", "issue_org_code"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Код подразделения" }, "issue_org": { "type": "input", "attributes": [], "name": "issue_org", "fullName": ["passport", "issue_org"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Наименование органа, выдавшего паспорт гражданина РФ" }, "reg_index": { "type": "input", "attributes": [], "name": "reg_index", "fullName": ["passport", "reg_index"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Индекс" }, "reg_federal": { "type": "input", "attributes": [], "name": "reg_federal", "fullName": ["passport", "reg_federal"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Федеральный округ" }, "reg_region": { "type": "input", "attributes": [], "name": "reg_region", "fullName": ["passport", "reg_region"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Регион" }, "reg_ctype": { "type": "input", "attributes": [], "name": "reg_ctype", "fullName": ["passport", "reg_ctype"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Тип населенного пункта" }, "reg_cname": { "type": "input", "attributes": [], "name": "reg_cname", "fullName": ["passport", "reg_cname"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Наименование населенного пункта" }, "reg_street": { "type": "input", "attributes": [], "name": "reg_street", "fullName": ["passport", "reg_street"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Улица" }, "reg_no_street": { "type": "checkbox", "attributes": [], "name": "reg_no_street", "fullName": ["passport", "reg_no_street"], "errors": [], "value": null, "label": "Нет улицы" }, "reg_house": { "type": "input", "attributes": [], "name": "reg_house", "fullName": ["passport", "reg_house"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Дом" }, "reg_build": { "type": "input", "attributes": [], "name": "reg_build", "fullName": ["passport", "reg_build"], "errors": [], "value": null, "label": "Корпус/строение" }, "reg_apt": { "type": "input", "attributes": [], "name": "reg_apt", "fullName": ["passport", "reg_apt"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Квартира" }, "reg_no_apt": { "type": "checkbox", "attributes": [], "name": "reg_no_apt", "fullName": ["passport", "reg_no_apt"], "errors": [], "value": null, "label": "Нет номера" }, "fact_reg": { "type": "checkbox", "attributes": [], "name": "fact_reg", "fullName": ["passport", "fact_reg"], "errors": [], "value": null, "label": "Совпадает с адресом регистрации" }, "fact_index": { "type": "input", "attributes": [], "name": "fact_index", "fullName": ["passport", "fact_index"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Индекс" }, "fact_federal": { "type": "input", "attributes": [], "name": "fact_federal", "fullName": ["passport", "fact_federal"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Федеральный округ" }, "fact_region": { "type": "input", "attributes": [], "name": "fact_region", "fullName": ["passport", "fact_region"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Регион" }, "fact_ctype": { "type": "input", "attributes": [], "name": "fact_ctype", "fullName": ["passport", "fact_ctype"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Тип населенного пункта" }, "fact_cname": { "type": "input", "attributes": [], "name": "fact_cname", "fullName": ["passport", "fact_cname"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Наименование населенного пункта" }, "fact_street": { "type": "input", "attributes": [], "name": "fact_street", "fullName": ["passport", "fact_street"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Улица" }, "fact_no_street": { "type": "checkbox", "attributes": [], "name": "fact_no_street", "fullName": ["passport", "fact_no_street"], "errors": [], "value": null, "label": "Нет улицы" }, "fact_house": { "type": "input", "attributes": [], "name": "fact_house", "fullName": ["passport", "fact_house"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Дом" }, "fact_build": { "type": "input", "attributes": [], "name": "fact_build", "fullName": ["passport", "fact_build"], "errors": [], "value": null, "label": "Корпус/строение" }, "fact_apt": { "type": "input", "attributes": [], "name": "fact_apt", "fullName": ["passport", "fact_apt"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Квартира" }, "fact_no_apt": { "type": "checkbox", "attributes": [], "name": "fact_no_apt", "fullName": ["passport", "fact_no_apt"], "errors": [], "value": null, "label": "Нет номера" }, "inn": { "type": "input", "attributes": [], "name": "inn", "fullName": ["passport", "inn"], "errors": ["Недостаточно данных для проверки"], "value": null, "label": "ИНН" }, "snils": { "type": "input", "attributes": [], "name": "snils", "fullName": ["passport", "snils"], "errors": [], "value": null, "label": "СНИЛС (при наличии)" }, "confirm_my_data": { "type": "checkbox", "attributes": [], "name": "confirm_my_data", "fullName": ["passport", "confirm_my_data"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "Я подтверждаю, что предоставленная информация верна" }, "sms_code": { "type": "input", "attributes": [], "name": "sms_code", "fullName": ["passport", "sms_code"], "errors": ["Поле обязательно для заполнения"], "value": null, "label": "SMS Код" } } }, "payment": { "type": "form", "attributes": [], "name": "payment", "fullName": ["payment"], "errors": [], "value": { "amount": null, "subscribe": null, "autopay_set": null }, "label": "", "elements": { "amount": { "type": "input", "attributes": [], "name": "amount", "fullName": ["payment", "amount"], "errors": [], "value": null, "label": "Первоначальный взнос (руб.)" }, "subscribe": { "type": "checkbox", "attributes": [], "name": "subscribe", "fullName": ["payment", "subscribe"], "errors": [], "value": null, "label": "Я хочу получать информационные материалы по электронной почте и SMS" }, "autopay_set": { "type": "checkbox", "attributes": [], "name": "autopay_set", "fullName": ["payment", "autopay_set"], "errors": [], "value": null, "label": "Подключить автоплатеж" } } } }, "hasErrors": true, "message": null, "data": null }

        return Observable.of(new HttpResponse({ status: 200, body: body }));
      }

      if (request.url.endsWith('/captcha/') && request.method === 'GET') {

        let body = {
          value: '0031173fe8d797b1ea7a291bbca4e93f',
          src: './assets/images/captcha.jpg',
        };

        return Observable.of(new HttpResponse({ status: 200, body: body }));
      }

      return next.handle(request);

    })

      .materialize()
      .delay(500)
      .dematerialize();
  }
}

export let mockBackendProvider = {
  provide: HTTP_INTERCEPTORS,
  useClass: mockBackend,
  multi: true
};